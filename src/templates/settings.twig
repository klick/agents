{% import '_includes/forms' as forms %}

{% set requestsFeatureEnabled = refundApprovalsExperimentalEnabled ?? false %}
{% set llmsTxtSettingLocked = llmsTxtSettingLocked ?? false %}
{% set commerceTxtSettingLocked = commerceTxtSettingLocked ?? false %}
<p class="light">
  Runtime options for API availability and discovery files{% if requestsFeatureEnabled %}, plus return-request fallback behavior{% endif %}.
</p>

{{ forms.lightswitchField({
  first: true,
  label: 'Enable Agents API',
  instructions: agentsEnabledLocked
    ? 'Controlled by PLUGIN_AGENTS_ENABLED in your environment.'
    : 'Turn the Agents API and related discovery endpoints on or off.',
  name: 'enabled',
  on: settings.enabled ?? true,
  onLabel: false,
  offLabel: false,
  disabled: agentsEnabledLocked,
}) }}

{{ forms.lightswitchField({
  label: 'Enable llms.txt',
  instructions: llmsTxtSettingLocked
    ? 'Controlled by config/agents.php (`enableLlmsTxt`).'
    : 'Serve or hide /llms.txt.',
  name: 'enableLlmsTxt',
  on: settings.enableLlmsTxt ?? true,
  onLabel: false,
  offLabel: false,
  disabled: llmsTxtSettingLocked,
}) }}

{{ forms.lightswitchField({
  label: 'Enable commerce.txt',
  instructions: commerceTxtSettingLocked
    ? 'Controlled by config/agents.php (`enableCommerceTxt`).'
    : 'Serve or hide /commerce.txt.',
  name: 'enableCommerceTxt',
  on: settings.enableCommerceTxt ?? true,
  onLabel: false,
  offLabel: false,
  disabled: commerceTxtSettingLocked,
}) }}

{% if requestsFeatureEnabled %}
  {{ forms.lightswitchField({
    label: 'Allow manual return requests in Return Requests tab',
    instructions: 'Use only as fallback. Recommended off: agents/integrations create requests, humans only approve/reject.',
    name: 'allowCpApprovalRequests',
    on: settings.allowCpApprovalRequests ?? false,
    onLabel: false,
    offLabel: false,
  }) }}
{% endif %}

{% if agentsEnabledLocked %}
  <p class="warning">`enabled` is locked by environment variable source: {{ agentsEnabledSource }}.</p>
{% endif %}
{% if llmsTxtSettingLocked or commerceTxtSettingLocked %}
  <p class="warning">Some discovery settings are controlled by `config/agents.php` and cannot be changed in CP.</p>
{% endif %}

<p><a href="{{ url('agents/dashboard/overview') }}">Back to Dashboard</a></p>
